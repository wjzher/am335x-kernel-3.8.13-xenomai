/*
 * Copyright (C) 2012 Texas Instruments Incorporated - http://www.ti.com/
 *
 * This program is free software; you can redistribute it and/or modify
 * it under the terms of the GNU General Public License version 2 as
 * published by the Free Software Foundation.
 */
/dts-v1/;

/include/ "am33xx.dtsi"

/include/ "am335x-agv-common.dtsi"

&cpu {
	/*
	 * To consider voltage drop between PMIC and SoC,
	 * tolerance value is reduced to 2% from 4% and
	 * voltage value is increased as a precaution.
	 */
	operating-points = <
		/* kHz    uV */
		800000	1300000
		600000  1112000
		300000   969000
	>;
};

&i2c2 {
	status = "disabled";
};

&am33xx_pinmux {
	userled_pins: pinmux_userled_pins {
		pinctrl-single,pins = <
			0x15C 0x7	/* SPI0_CS0.gpio0_5 */
			0x158 0x7	/* SPI0_D1.gpio0_4 */
			0x1A8 0x7	/* MCASP0_AXR1.gpio3_20 */
		>;
	};
	gpmc_pins: pinmux_gpmc_pins {
		pinctrl-single,pins = <
			0x0	0x30	/* gpmc_ad0.gpmc_ad0 */
			0x4	0x30	/* gpmc_ad1.gpmc_ad1 */
			0x8	0x30	/* gpmc_ad2.gpmc_ad2 */
			0xc	0x30	/* gpmc_ad3.gpmc_ad3 */
			0x10	0x30	/* gpmc_ad4.gpmc_ad4 */
			0x14	0x30	/* gpmc_ad5.gpmc_ad5 */
			0x18	0x30	/* gpmc_ad6.gpmc_ad6 */
			0x1c	0x30	/* gpmc_ad7.gpmc_ad7 */
			0x70	0x30	/* gpmc_wait0.gpmc_wait0 */
			/* 0x74	0x37 */	/* gpmc_wpn.gpio0_30 */
			0x7c	0x10	/* gpmc_csn0.gpmc_csn0  */
			0x90	0x10	/* gpmc_advn_ale.gpmc_advn_ale */
			0x94	0x10	/* gpmc_oen_ren.gpmc_oen_ren */
			0x98	0x10	/* gpmc_wen.gpmc_wen */
			0x9c	0x10	/* gpmc_be0n_cle.gpmc_be0n_cle */
			/* for fpga */
			0x20	0x30	/* gpmc_ad8.gpmc_ad8 MODE0 | INPUT | PULLUP */
			0x24	0x30	/* gpmc_ad9.gpmc_ad9 MODE0 | INPUT | PULLUP */
			0x28	0x30	/* gpmc_ad10.gpmc_ad10 MODE0 | INPUT | PULLUP */
			0x2C	0x30	/* gpmc_ad11.gpmc_ad11 MODE0 | INPUT | PULLUP */
			0x30	0x30	/* gpmc_ad12.gpmc_ad12 MODE0 | INPUT | PULLUP */
			0x34	0x30	/* gpmc_ad13.gpmc_ad13 MODE0 | INPUT | PULLUP */
			0x38	0x30	/* gpmc_ad14.gpmc_ad14 MODE0 | INPUT | PULLUP */
			0x3C	0x30	/* gpmc_ad15.gpmc_ad15 MODE0 | INPUT | PULLUP */
			0x80	0x08	/* gpmc_cscn1.gpmc_cscn1 MODE0 | OUTPUT */
			0x40	0x08	/* gpmc_a0.gpmc_a0 MODE0 */
			0x44	0x08	/* gpmc_a1.gpmc_a1 MODE0 */
			0x48	0x08	/* gpmc_a2.gpmc_a2 MODE0 */
			0x4C	0x08	/* gpmc_a3.gpmc_a2 MODE0 */
			0x50	0x08	/* gpmc_a4.gpmc_a4 MODE0 */
			0x54	0x08	/* gpmc_a5.gpmc_a5 MODE0 */
			0x58	0x08	/* gpmc_a6.gpmc_a6 MODE0 */
			0x5C	0x08	/* gpmc_a7.gpmc_a7 MODE0 */
			/* for profibus&profinet */
			0x84	0x08	/* gpmc_cscn2.gpmc_cscn2 MODE0 | OUTPUT */
			0x88	0x08	/* gpmc_cscn3.gpmc_cscn3 MODE0 | OUTPUT */
			0x60	0x08	/* gpmc_a8.gpmc_a8 MODE0 */
			0x64	0x08	/* gpmc_a9.gpmc_a9 MODE0 */
			0x68	0x08	/* gpmc_a10.gpmc_a10 MODE0 */
			0x6C	0x08	/* gpmc_a11.gpmc_a11 MODE0 */
		>;
	};
	mmc1_pins: pinmux_mmc1_pins {
		pinctrl-single,pins = <
			0x1A4 0x2f /* GPIO3_19 (PIN_INPUT | MUX_MODE7) */
		>;
	};
	dcan0_pins: pinmux_dcan0_pins {
		pinctrl-single,pins = <
			0x178 0x12 	/* uart1_ctsn, SLEWCTRL_FAST | INPUT_PULLUP | MODE2 | TX */
			0x17c 0x32	/* uart1_rtsn, SLEWCTRL_FAST | RECV_ENABLE | INPUT_PULLUP | MODE2 | RX */
		>;
	};
	dcan1_pins: pinmux_dcan1_pins {
		pinctrl-single,pins = <
			0x168 0x12 	/* uart0_ctsn, SLEWCTRL_FAST | INPUT_PULLUP | MODE2 | TX */
			0x16c 0x32	/* uart0_rtsn, SLEWCTRL_FAST | RECV_ENABLE | INPUT_PULLUP | MODE2 | RX */
		>;
	};
	uart2_pins: pinmux_uart2_pins {
		pinctrl-single,pins = <
			0x180 0x30	/* uart1_rxd, MODE0 | PULLUP_EN | RXACTIVE */
			0x184 0x0	/* uart1_txd, MODE0 */
		>;
	};
	uart3_pins: pinmux_uart3_pins {
		pinctrl-single,pins = <
			0x150 0x31	/* spi0_clk, MODE1 | PULLUP_EN | RXACTIVE */
			0x154 0x01	/* spi0_d0, MODE1 */
		>;
	};
	uart4_pins: pinmux_uart4_pins {
		pinctrl-single,pins = <
			0x160 0x31	/* spi0_cs1, MODE1 | PULLUP_EN | RXACTIVE */
			0x164 0x01	/* lcd_enbkl eCAP0_in_PWM0_out, MODE1 */
		>;
	};
	gpio_helper_pins: pinmux_gpio_helper_pins {
		pinctrl-single,pins = <
			0x8C	0x7	/* gpmc_CLK.gpmc_wait1 GPIO2[1] MODE2, 24V ctrl */
			0x1AC 0x7	/* MCASP0_AHCLKX GPIO3[21], OUTPUT | MODE7 --> USER LED */
			0x1a0 0x17	/* mcasp0_aclkr GPIO3[18], OUTPUT_PULLUP | MODE7 --> UART3_DE */
		>;
	};
};

&ocp {
	gpio-leds {
		compatible = "gpio-leds";
		pinctrl-names = "default";
		pinctrl-0 = <&userled_pins>;

		led0 {
			label = "beaglebone:green:usr0";
			gpios = <&gpio1 5 1>;
			linux,default-trigger = "heartbeat";
			default-state = "off";
		};

		led1 {
			label = "beaglebone:green:usr1";
			gpios = <&gpio1 4 1>;
			linux,default-trigger = "mmc0";
			default-state = "off";
		};

		led2 {
			label = "beaglebone:green:usr2";
			gpios = <&gpio4 20 1>;
			linux,default-trigger = "cpu0";
			default-state = "off";
		};

	};

	gpio_helper {
		compatible = "gpio-of-helper";
		status = "okay";
		pinctrl-names = "default";
		pinctrl-0 = <&gpio_helper_pins>;

		/* declare your gpios */
		test_led {
			gpio-name = "test_led";
			gpio = <&gpio4 21 0x00>;	/* gpio2 is gpio1, active_low = 0 */
			output;
			init-high;
		};
		ctl24v {
			gpio-name = "ctl24v";
			gpio = <&gpio3 1 0x00>;		/* gpio4 is gpio3, active_low = 0 */
			output;
			init-high;
		};
		uart3_de {
			gpio-name = "uart3_de";
			gpio = <&gpio4 18 0x00>;		/* gpio4 is gpio3, active_low = 0 */
			output;
			init-low;
		};
	};
};

/*
&cpsw_emac0 {
	phy_id = <&davinci_mdio>, <0>;
};

&cpsw_emac1 {
	phy_id = <&davinci_mdio>, <1>;
};
*/

&mmc1 {
	pinctrl-names = "default";
	pinctrl-0 = <&mmc1_pins>;
	bus-width = <0x4>;
	cd-gpios = <&gpio4 14 0>; /* gpio3 is misnamed, 0 == GPIO_ACTIVE_HIGH */
	cd-inverted;
	status = "okay";
	/* vmmc-supply = <&ldo4_reg>; */
	ti,vcc-aux-disable-is-sleep;
};

&dcan0 {
	status = "okay";
	pinctrl-names = "default";
	pinctrl-0 = <&dcan0_pins>;
};

&dcan1 {
	status = "okay";
	pinctrl-names = "default";
	pinctrl-0 = <&dcan1_pins>;
};

&uart2 {
	pinctrl-names = "default";
	pinctrl-0 = <&uart2_pins>;
	status = "okay";
};

&uart3 {
	pinctrl-names = "default";
	pinctrl-0 = <&uart3_pins>;
	status = "okay";
};

&uart4 {
	pinctrl-names = "default";
	pinctrl-0 = <&uart4_pins>;
	status = "okay";
};

&gpmc {
	status = "okay";
	pinctrl-names = "default";
	pinctrl-0 = <&gpmc_pins>;
	ranges = <0 0 0x08000000 0x1000000>,	/* CS0: 16MB for NAND */
			 <1 0 0x10000000 0x1000000>,	/* CS1: 16MB for fpga */
			 <2 0 0x18000000 0x1000000>,	/* CS1: 16MB for PROFIBUS */
			 <3 0 0x20000000 0x1000000>;	/* CS1: 16MB for PROFINET */
	nand@0,0 {
		reg = <0 0 0>;		/* CS0, offset 0 */
		ti,nand-ecc-opt = "bch8";
		/* ti,elm-id = <&elm>; */	/* unsupport */
		nand-bus-width = <8>;
		gpmc,device-width = <1>;
		gpmc,sync-clk-ps = <0>;		/* timings */
		gpmc,cs-on-ns = <0>;
		gpmc,cs-rd-off-ns = <170>;
		gpmc,cs-wr-off-ns = <170>;
		gpmc,adv-on-ns = <50>;
		gpmc,adv-rd-off-ns = <120>;
		gpmc,adv-wr-off-ns = <120>;
		gpmc,we-on-ns = <0>;
		gpmc,we-off-ns = <90>;
		gpmc,oe-on-ns = <0>;
		gpmc,oe-off-ns = <90>;
		gpmc,access-ns = <90>;
		gpmc,rd-cycle-ns = <150>;
		gpmc,wr-cycle-ns = <150>;
		gpmc,wait-on-read = "true";
		gpmc,wait-on-write = "true";
		/* gpmc,wait-pin = <0>; */
		gpmc,bus-turnaround-ns = <0>;
		gpmc,cycle2cycle-delay-ns = <0>;
		gpmc,clk-activation-ns = <0>;
		gpmc,wait-monitoring-ns = <0>;
		gpmc,wr-access-ns = <100>;
		gpmc,wr-data-mux-bus-ns = <0>;
		gpmc,device-nand = "true";
		/* MTD partition table */
		/* All SPL-* partitions are sized to minimal length
		 * which can be independently programmable. For
		 * NAND flash this is equal to size of erase-block */
		#address-cells = <1>;
		#size-cells = <1>;
		partition@0 {
			label = "NAND.SPL";
			reg = <0x00000000 0x000020000>;		/* offset, size */
		};
		partition@1 {
			label = "NAND.SPL.backup1";
			reg = <0x00020000 0x00020000>;
		};
		partition@2 {
			label = "NAND.SPL.backup2";
			reg = <0x00040000 0x00020000>;
		};
		partition@3 {
			label = "NAND.SPL.backup3";
			reg = <0x00060000 0x00020000>;
		};
		partition@4 {
			label = "NAND.u-boot-spl-os";
			reg = <0x00080000 0x00040000>;
		};
		partition@5 {
			label = "NAND.u-boot";
			reg = <0x000C0000 0x00100000>;
		};
		partition@6 {
			label = "NAND.u-boot-env";
			reg = <0x001C0000 0x00020000>;
		};
		partition@7 {
			label = "NAND.u-boot-env.backup1";
			reg = <0x001E0000 0x00020000>;
		};
		partition@8 {
			label = "NAND.kernel";
			reg = <0x00200000 0x00800000>;
		};
		partition@9 {
			label = "NAND.file-system";
			reg = <0x00A00000 0x0F600000>;
		};
	};
	fpga@1,0 {
		reg = <1 0 0x1000000>;		/* CS1, offset 0 */
		bank-width = <2>;
		gpmc,device-width = <2>;
		gpmc,sync-clk-ps = <0>;		/* timings */
		gpmc,cs-on-ns = <0>;
		gpmc,cs-rd-off-ns = <80>;
		gpmc,cs-wr-off-ns = <70>;
		gpmc,adv-on-ns = <0>;
		gpmc,adv-rd-off-ns = <0>;
		gpmc,adv-wr-off-ns = <0>;
		gpmc,we-on-ns = <10>;
		gpmc,we-off-ns = <70>;
		gpmc,oe-on-ns = <10>;
		gpmc,oe-off-ns = <70>;
		gpmc,access-ns = <60>;
		gpmc,rd-cycle-ns = <70>;
		gpmc,wr-cycle-ns = <60>;
		gpmc,wr-access-ns = <10>;
		#address-cells = <1>;
		#size-cells = <1>;
	};
	profibus@2,0 {
		reg = <2 0 0x1000000>;		/* CS1, offset 0 */
		bank-width = <2>;
		gpmc,device-width = <2>;
		gpmc,sync-clk-ps = <0>;		/* timings */
		gpmc,cs-on-ns = <0>;
		gpmc,cs-rd-off-ns = <80>;
		gpmc,cs-wr-off-ns = <70>;
		gpmc,adv-on-ns = <0>;
		gpmc,adv-rd-off-ns = <0>;
		gpmc,adv-wr-off-ns = <0>;
		gpmc,we-on-ns = <10>;
		gpmc,we-off-ns = <70>;
		gpmc,oe-on-ns = <10>;
		gpmc,oe-off-ns = <70>;
		gpmc,access-ns = <60>;
		gpmc,rd-cycle-ns = <70>;
		gpmc,wr-cycle-ns = <60>;
		gpmc,wr-access-ns = <10>;
		#address-cells = <1>;
		#size-cells = <1>;
	};
	profinet@3,0 {
		reg = <3 0 0x1000000>;		/* CS1, offset 0 */
		bank-width = <2>;
		gpmc,device-width = <2>;
		gpmc,sync-clk-ps = <0>;		/* timings */
		gpmc,cs-on-ns = <0>;
		gpmc,cs-rd-off-ns = <80>;
		gpmc,cs-wr-off-ns = <70>;
		gpmc,adv-on-ns = <0>;
		gpmc,adv-rd-off-ns = <0>;
		gpmc,adv-wr-off-ns = <0>;
		gpmc,we-on-ns = <10>;
		gpmc,we-off-ns = <70>;
		gpmc,oe-on-ns = <10>;
		gpmc,oe-off-ns = <70>;
		gpmc,access-ns = <60>;
		gpmc,rd-cycle-ns = <70>;
		gpmc,wr-cycle-ns = <60>;
		gpmc,wr-access-ns = <10>;
		#address-cells = <1>;
		#size-cells = <1>;
	};
};

&usb_otg_hs {
	interface_type = <1>;
	power = <250>;
	/* port0-mode = <0>; */
	port1-mode = <1>;	/* HOST 1; PERIPHERAL 2, OTG 3 */
	status = "okay";
};
